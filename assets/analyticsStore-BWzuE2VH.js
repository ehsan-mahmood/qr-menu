import{T as p,J as g,K as c,D as v,s as h,r as u,j as y}from"./index-Dpv-nFGf.js";import{d as r,a as D}from"./demoStorage-LjyBGDXa.js";const f={async postEvent(t){if(p){if(await new Promise(a=>setTimeout(a,200)),console.log("ðŸ“Š Analytics Event (Test Mode):",t),g){const{eventType:a,...e}=t;a==="menu_scan"?r.trackScan(e.qrToken||e.menuId):a==="menu_view"?r.trackView(e.menuId):a==="item_click"?r.trackClick(e.itemName):a==="order_placed"&&r.trackOrder()}return{data:{messageId:"EVENT_RECORDED",receivingId:`event-${Date.now()}`,success:!0}}}return await v.post("/analytics/events",t)},async getDashboardData(t,o){if(p)if(await new Promise(e=>setTimeout(e,500)),g){const e=r.getClicks(),i=Object.keys(e).length>0?r.getTopItems(10):c.topItems,d=r.getScans().length;r.getViews().length;const m=D.getAll().length;return{data:{...c,topItems:i,totalScans:d||c.totalScans,totalOrders:m||c.totalOrders,messageId:"ANALYTICS_RETRIEVED",receivingId:`analytics-${Date.now()}`}}}else return{data:{...c,messageId:"ANALYTICS_RETRIEVED",receivingId:`analytics-${Date.now()}`}};return await v.get(`/analytics/dashboard/${t}`,{params:o})},async getTopItems(t,o=10){if(p)if(await new Promise(e=>setTimeout(e,400)),g){const e=r.getClicks();return{data:Object.keys(e).length>0?r.getTopItems(o):c.topItems.slice(0,o)}}else return{data:c.topItems.slice(0,o)};return await v.get(`/analytics/top-items/${t}`,{params:{limit:o}})}},k=h("analytics",()=>{const t=u(null),o=u([]),a=u(!1),e=u(null),i=y(()=>{var s;return((s=t.value)==null?void 0:s.totalScans)||0}),d=y(()=>{var s;return((s=t.value)==null?void 0:s.totalOrders)||0}),m=y(()=>{var s;return((s=t.value)==null?void 0:s.avgOrderValue)||0});async function I(s,l){a.value=!0,e.value=null;try{const n=await f.getDashboardData(s,l);return t.value=n.data,n.data.topItems&&(o.value=n.data.topItems),n.data}catch(n){throw e.value=n.message||"Failed to load analytics",n}finally{a.value=!1}}async function w(s,l=10){a.value=!0,e.value=null;try{const n=await f.getTopItems(s,l);return o.value=n.data,n.data}catch(n){throw e.value=n.message||"Failed to load top items",n}finally{a.value=!1}}async function T(s){try{await f.postEvent(s)}catch(l){console.error("Failed to post analytics event:",l)}}function E(){t.value=null,o.value=[],e.value=null}return{dashboardData:t,topItems:o,loading:a,error:e,totalScans:i,totalOrders:d,avgOrderValue:m,fetchDashboardData:I,fetchTopItems:w,postEvent:T,clearAnalytics:E}});export{k as u};
