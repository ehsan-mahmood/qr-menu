import{u as Z,r as i,k as $,o as ee,T as te,K as se,c as o,d as t,e as x,t as v,g as ae,b as oe,h,l as le,v as _,n as P,F as I,m as U,w as ne,j as l}from"./index-DFIQAtI0.js";import{m as D}from"./menuService-8q0fWx17.js";import{q as re}from"./qrService-CNcWsmRh.js";import{o as ie,a as L,p as ue}from"./csvParser-C3E3KsB4.js";import"./_commonjsHelpers-Cpj98o6Y.js";const de={class:"min-h-screen bg-gray-50"},ce={class:"bg-white shadow-sm"},me={class:"container mx-auto px-4 py-4"},pe={class:"flex items-center justify-between mb-4"},ve={key:0,class:"text-sm text-gray-500 mt-1"},be={class:"container mx-auto px-4 py-6 max-w-4xl"},ye={key:0,class:"text-center py-12"},xe={key:1,class:"card bg-red-50 border border-red-200 text-center"},ge={class:"text-red-700 mb-4"},fe={key:2,class:"space-y-6"},he={class:"card"},_e={class:"card"},ke={class:"flex gap-2 border-b border-gray-200 mb-4"},Ce={key:0,class:"space-y-4"},Me={key:0,class:"text-4xl mb-3"},we={key:1,class:"text-4xl mb-3"},Se={class:"font-medium text-gray-900"},Re=["disabled"],Ve={key:0},Ie={key:1},Ue={key:1,class:"space-y-4"},Fe={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},Oe={class:"text-xs text-blue-800"},Pe={key:0,class:"border rounded-lg p-4"},Te={class:"font-semibold text-gray-900 mb-2"},Ee={class:"text-sm text-gray-700 space-y-1 ml-4"},Ne={key:1,class:"space-y-4"},Be={key:0,class:"text-4xl mb-3"},$e={key:1,class:"text-4xl mb-3"},De={class:"font-medium text-gray-900"},Le={key:2,class:"space-y-4"},je={class:"bg-gray-50 border border-gray-200 rounded-lg p-4"},qe={class:"flex items-center justify-between mb-3"},Ae=["onUpdate:modelValue"],ze=["onClick"],Ge={class:"grid grid-cols-1 md:grid-cols-3 gap-2 mb-2"},Qe=["onUpdate:modelValue"],Je=["onUpdate:modelValue"],Ke=["onUpdate:modelValue"],He=["onUpdate:modelValue"],We=["onClick"],Xe=["onClick"],Ye={class:"card bg-blue-50 border border-blue-200"},Ze=["disabled"],et={key:0},tt={key:1},st={key:0,class:"text-xs text-gray-600 mt-2 text-center"},ut={__name:"MenuEdit",setup(at){const T=oe(),M=Z(),w=i(!0),b=i(null),C=i(!1),j=i(null),k=i(""),c=i("manual"),E=i(null),g=i(null),S=i(!1),F=i(0),R=i(""),y=i(""),p=i([]),N=i(null),V=i(null),m=i([]),q=$(()=>p.value.reduce((n,e)=>n+e.items.length,0)),O=$(()=>c.value==="manual"?m.value.length>0&&m.value.some(n=>n.items.length>0):c.value==="ocr"?p.value.length>0:c.value==="csv"?m.value.length>0:!1);ee(async()=>{await B()});const B=async()=>{var n,e;w.value=!0,b.value=null;try{const s=M.merchantId||((n=M.user)==null?void 0:n.merchantId)||"merchant-001";let a=null;try{const f=(await re.getMerchantQRCodes(s)).data||[];f.length>0&&(a=f[0].menuId)}catch(d){console.log("Could not get menu ID from QR codes:",d)}if(!a&&te&&(a=se.menuId),!a){b.value="No menu found. Please create a menu first.",w.value=!1;return}j.value=a;const r=await D.getMenuById(a),u=((e=r.data)==null?void 0:e.data)||r.data;k.value=u.menuName||"Main Menu",u.sections&&u.sections.length>0?m.value=u.sections.map(d=>({name:d.name,items:d.items.map(f=>({name:f.name,description:f.description||"",price:f.price,category:f.category||""}))})):m.value=[{name:"Menu Items",items:[]}]}catch(s){console.error("Failed to load menu:",s),b.value=s.message||"Failed to load menu. Please try again."}finally{w.value=!1}},A=n=>{const e=n.target.files[0];e&&(g.value=e,R.value="",y.value="",p.value=[])},z=async()=>{var n;if(g.value){S.value=!0,F.value=0;try{const e=await ie.parseMenuImage(g.value,a=>{F.value=a}),s=((n=e.data)==null?void 0:n.data)||e.data;R.value=s.parsedText||"",y.value=s.parsedText||"",p.value=s.sections||[],p.value.length===0&&y.value&&(p.value=L(y.value))}catch(e){console.error("OCR processing error:",e),b.value=e.message||"Failed to process image. Please try again."}finally{S.value=!1}}},G=()=>{y.value.trim()&&(p.value=L(y.value))},Q=async n=>{const e=n.target.files[0];if(e){V.value=e;try{const s=await e.text(),a=ue(s);m.value=a}catch(s){console.error("CSV parsing error:",s),b.value=s.message||"Failed to parse CSV file. Please check the format."}}},J=()=>{const n=`name,price,description,category
Espresso,3.50,Strong Italian coffee,Coffee
Cappuccino,4.50,Espresso with steamed milk,Coffee
Croissant,3.00,Buttery French pastry,Pastry`,e=new Blob([n],{type:"text/csv"}),s=URL.createObjectURL(e),a=document.createElement("a");a.href=s,a.download="menu_template.csv",a.click(),URL.revokeObjectURL(s)},K=()=>{m.value.push({name:"",items:[]})},H=n=>{m.value.splice(n,1)},W=n=>{m.value[n].items.push({name:"",description:"",price:0,category:""})},X=(n,e)=>{m.value[n].items.splice(e,1)},Y=async()=>{var n;if(O.value){C.value=!0,b.value=null;try{const e=M.merchantId||((n=M.user)==null?void 0:n.merchantId)||"merchant-001";let s=[];if(c.value==="ocr"&&p.value.length>0?s=p.value:s=m.value.map(r=>({name:r.name,items:r.items.map(u=>({name:u.name,description:u.description||"",price:parseFloat(u.price)||0,category:u.category||"",available:!0}))})),s=s.filter(r=>r.name&&r.items.length>0),s.length===0){b.value="Please add at least one menu item before saving.",C.value=!1;return}const a=await D.createOrUpdateMenu({merchantId:e,menuName:k.value||"Main Menu",orderEnabled:!0,sections:s});alert("âœ… Menu saved successfully!"),T.push("/dashboard")}catch(e){console.error("Failed to save menu:",e),b.value=e.message||"Failed to save menu. Please try again."}finally{C.value=!1}}};return(n,e)=>(l(),o("div",de,[t("div",ce,[t("div",me,[t("div",pe,[t("div",null,[e[8]||(e[8]=t("h1",{class:"text-xl font-bold text-gray-900"},"Edit Menu",-1)),k.value?(l(),o("p",ve,v(k.value),1)):x("",!0)]),t("button",{onClick:e[0]||(e[0]=s=>ae(T).push("/dashboard")),class:"text-sm text-gray-600 hover:text-gray-900 underline"}," â† Back to Dashboard ")])])]),t("div",be,[w.value?(l(),o("div",ye,[...e[9]||(e[9]=[t("div",{class:"text-4xl mb-4"},"â³",-1),t("p",{class:"text-gray-600"},"Loading menu...",-1)])])):b.value?(l(),o("div",xe,[e[10]||(e[10]=t("div",{class:"text-4xl mb-4"},"âš ï¸",-1)),e[11]||(e[11]=t("h3",{class:"text-lg font-bold text-red-900 mb-2"},"Failed to Load Menu",-1)),t("p",ge,v(b.value),1),t("button",{onClick:B,class:"btn btn-primary"}," Try Again ")])):(l(),o("div",fe,[t("div",he,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},[le(" Menu Name "),t("span",{class:"text-red-500"},"*")],-1)),h(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>k.value=s),type:"text",class:"input",placeholder:"e.g., Main Menu, Breakfast Menu"},null,512),[[_,k.value]])]),t("div",_e,[e[19]||(e[19]=t("h3",{class:"font-bold text-gray-900 mb-4"},"ðŸ“‹ Update Menu Items",-1)),e[20]||(e[20]=t("p",{class:"text-sm text-gray-600 mb-4"},"Choose how you'd like to update your menu",-1)),t("div",ke,[t("button",{onClick:e[2]||(e[2]=s=>c.value="ocr"),class:P(["px-4 py-2 font-medium transition-colors",c.value==="ocr"?"text-primary-600 border-b-2 border-primary-600":"text-gray-600 hover:text-gray-900"])}," ðŸ“· OCR Upload ",2),t("button",{onClick:e[3]||(e[3]=s=>c.value="csv"),class:P(["px-4 py-2 font-medium transition-colors",c.value==="csv"?"text-primary-600 border-b-2 border-primary-600":"text-gray-600 hover:text-gray-900"])}," ðŸ“Š CSV Upload ",2),t("button",{onClick:e[4]||(e[4]=s=>c.value="manual"),class:P(["px-4 py-2 font-medium transition-colors",c.value==="manual"?"text-primary-600 border-b-2 border-primary-600":"text-gray-600 hover:text-gray-900"])}," âœï¸ Manual Entry ",2)]),c.value==="ocr"?(l(),o("div",Ce,[t("div",{class:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-primary-500 transition-colors cursor-pointer",onClick:e[5]||(e[5]=s=>{var a;return(a=E.value)==null?void 0:a.click()})},[t("input",{ref_key:"ocrFileInput",ref:E,type:"file",accept:"image/*",class:"hidden",onChange:A},null,544),g.value?(l(),o("div",we,"âœ…")):(l(),o("div",Me,"ðŸ“·")),t("p",Se,v(g.value?g.value.name:"Click to upload menu image"),1),e[13]||(e[13]=t("p",{class:"text-sm text-gray-500 mt-1"},"PNG, JPG up to 10MB",-1))]),g.value&&!R.value?(l(),o("button",{key:0,onClick:z,disabled:S.value,class:"w-full btn btn-primary disabled:opacity-50"},[S.value?(l(),o("span",Ve,"Processing... "+v(F.value)+"%",1)):(l(),o("span",Ie,"Parse Menu"))],8,Re)):x("",!0),R.value?(l(),o("div",Ue,[t("div",Fe,[e[14]||(e[14]=t("p",{class:"text-sm font-semibold text-blue-900 mb-2"},"âœ… OCR Results",-1)),t("p",Oe," Found "+v(q.value)+" items. Review and edit below if needed. ",1)]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Editable OCR Text ",-1)),h(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=s=>y.value=s),rows:"10",class:"input font-mono text-sm",placeholder:"Edit the extracted text here..."},null,512),[[_,y.value]]),t("button",{onClick:G,class:"mt-2 btn btn-secondary text-sm"}," Re-parse Text ")]),p.value.length>0?(l(),o("div",Pe,[e[16]||(e[16]=t("h4",{class:"font-bold text-gray-900 mb-3"},"ðŸ“‹ Parsed Menu Structure",-1)),(l(!0),o(I,null,U(p.value,(s,a)=>(l(),o("div",{key:a,class:"mb-4 last:mb-0"},[t("p",Te,v(s.name)+" ("+v(s.items.length)+" items)",1),t("ul",Ee,[(l(!0),o(I,null,U(s.items,(r,u)=>(l(),o("li",{key:u}," â€¢ "+v(r.name)+" - $"+v(r.price.toFixed(2)),1))),128))])]))),128))])):x("",!0)])):x("",!0)])):x("",!0),c.value==="csv"?(l(),o("div",Ne,[t("div",{class:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-primary-500 transition-colors cursor-pointer",onClick:e[7]||(e[7]=s=>{var a;return(a=N.value)==null?void 0:a.click()})},[t("input",{ref_key:"csvFileInput",ref:N,type:"file",accept:".csv",class:"hidden",onChange:Q},null,544),V.value?(l(),o("div",$e,"âœ…")):(l(),o("div",Be,"ðŸ“Š")),t("p",De,v(V.value?V.value.name:"Click to upload CSV file"),1),e[17]||(e[17]=t("p",{class:"text-sm text-gray-500 mt-1"},"CSV file with columns: name, price, description, category",-1))]),t("a",{href:"#",onClick:ne(J,["prevent"]),class:"text-sm text-primary-600 hover:underline block text-center"}," ðŸ“¥ Download CSV Template ")])):x("",!0),c.value==="manual"?(l(),o("div",Le,[t("div",je,[e[18]||(e[18]=t("p",{class:"text-sm text-gray-700 mb-4"}," Add or edit menu items manually. Items are organized by sections. ",-1)),(l(!0),o(I,null,U(m.value,(s,a)=>(l(),o("div",{key:a,class:"mb-6 last:mb-0"},[t("div",qe,[h(t("input",{"onUpdate:modelValue":r=>s.name=r,type:"text",class:"input flex-1 font-semibold",placeholder:"Section Name (e.g., Breakfast, Lunch)"},null,8,Ae),[[_,s.name]]),t("button",{onClick:r=>H(a),class:"ml-2 text-red-600 hover:text-red-800"}," Ã— Remove ",8,ze)]),(l(!0),o(I,null,U(s.items,(r,u)=>(l(),o("div",{key:u,class:"mb-3 p-3 bg-white border rounded-lg"},[t("div",Ge,[h(t("input",{"onUpdate:modelValue":d=>r.name=d,type:"text",placeholder:"Item name",class:"input text-sm"},null,8,Qe),[[_,r.name]]),h(t("input",{"onUpdate:modelValue":d=>r.price=d,type:"number",step:"0.01",placeholder:"Price",class:"input text-sm"},null,8,Je),[[_,r.price,void 0,{number:!0}]]),h(t("input",{"onUpdate:modelValue":d=>r.category=d,type:"text",placeholder:"Category",class:"input text-sm"},null,8,Ke),[[_,r.category]])]),h(t("textarea",{"onUpdate:modelValue":d=>r.description=d,rows:"2",placeholder:"Description (optional)",class:"input text-sm mb-2"},null,8,He),[[_,r.description]]),t("button",{onClick:d=>X(a,u),class:"text-xs text-red-600 hover:text-red-800"}," Remove Item ",8,We)]))),128)),t("button",{onClick:r=>W(a),class:"text-sm btn btn-secondary"}," + Add Item to "+v(s.name||"Section"),9,Xe)]))),128)),t("button",{onClick:K,class:"w-full btn btn-secondary mt-4"}," + Add New Section ")])])):x("",!0)]),t("div",Ye,[t("button",{onClick:Y,disabled:C.value||!O.value,class:"w-full btn btn-primary disabled:opacity-50"},[C.value?(l(),o("span",et,"Saving menu...")):(l(),o("span",tt,"ðŸ’¾ Save Menu Changes"))],8,Ze),O.value?x("",!0):(l(),o("p",st," Please add at least one menu item before saving "))])]))])]))}};export{ut as default};
