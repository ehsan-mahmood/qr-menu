import{_ as G,r as p,k as K,c as a,d as e,f as Y,e as g,A as E,n as k,F as S,m as M,t as i,w as J,l as W,g as H,T as y,q as Q,h as X,v as Z,y as R,z as P,b as ee,j as l}from"./index-WVObp_XA.js";import{a as te,p as se,o as ae}from"./csvParser-D1VKDUg_.js";import"./_commonjsHelpers-Cpj98o6Y.js";const le={class:"min-h-screen bg-gray-50"},oe={class:"container mx-auto px-4 py-6 max-w-2xl"},re={class:"card mb-6"},ne={class:"grid grid-cols-1 md:grid-cols-3 gap-3 mb-4"},ie={class:"card mb-6"},de={class:"font-bold text-gray-900 mb-4"},ue={key:0},ce={key:1},ve={key:2},me={key:3},pe={key:0,class:"mb-4"},ge={key:0,class:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center"},fe={key:1,class:"grid grid-cols-2 md:grid-cols-3 gap-3"},xe=["onClick"],be=["src"],ye={class:"text-xs font-medium text-gray-900 truncate"},he={class:"text-xs text-gray-500"},_e={key:1,class:"mb-4"},Ce={class:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-primary-500 transition-colors"},we={key:0,class:"space-y-2"},ke={class:"text-4xl"},Te={class:"text-gray-600"},Se={class:"text-sm text-gray-500"},Me={key:1,class:"space-y-2"},Oe={class:"font-medium text-gray-900"},Ee={class:"text-sm text-gray-500"},Re=["accept","disabled"],Pe={key:0,class:"mt-2 text-center"},De=["disabled"],Ie={key:0},Fe={key:1},Ve={key:2},Ue={key:3},$e={key:3,class:"mt-2 p-2 bg-gray-100 rounded text-xs"},Le={key:0,class:"card bg-yellow-50 border border-yellow-200 mb-6"},Be={class:"text-center"},Ne={class:"mt-4 bg-yellow-200 rounded-full h-2 overflow-hidden"},je={key:1,class:"card mb-6"},ze={class:"flex justify-between items-center mb-3"},Ae={key:0,class:"text-sm text-gray-600"},qe={key:0,class:"mt-4 border-t pt-4"},Ge={class:"text-sm text-gray-600 mb-3"},Ke={class:"space-y-4 max-h-96 overflow-y-auto"},Ye={class:"font-semibold text-gray-900 mb-2"},Je={class:"space-y-2"},We={class:"flex justify-between items-start"},He={class:"flex-1"},Qe={class:"font-medium text-gray-900"},Xe={key:0,class:"text-xs text-gray-600 mt-1"},Ze={class:"font-semibold text-primary-600 ml-2"},et={key:0,class:"card bg-green-50 border border-green-200"},tt={class:"text-center"},st={class:"font-medium text-green-900"},at={key:0,class:"card bg-red-50 border border-red-200"},lt={class:"text-center"},ot={class:"font-medium text-red-900"},rt={__name:"OCRImport",setup(nt){const D=ee(),o=p("ocr"),n=p(null),x=p(null),b=p(!1),_=p(0),c=p(""),f=p(""),C=p(null),v=p(""),u=p(""),d=p([]),w=p([]),T=K(()=>d.value.reduce((s,t)=>s+t.items.length,0)),I=s=>{const t=s.target.files[0];if(t){if(o.value==="csv"){if(!t.name.endsWith(".csv")){u.value="Please select a CSV file";return}}else if(t.size>10*1024*1024){u.value="File size must be less than 10MB";return}n.value=t,x.value=null,u.value=""}},F=s=>s<1024?s+" B":s<1024*1024?(s/1024).toFixed(1)+" KB":(s/(1024*1024)).toFixed(1)+" MB",V=()=>{var s;console.log("üî¥ BUTTON CLICKED - handleProcessClick"),console.log("Method:",o.value),console.log("File:",(s=n.value)==null?void 0:s.name),console.log("TEST_MODE:",y),U()},U=async()=>{var s,t;if(console.log("=== processMenu called ==="),console.log("uploadMethod:",o.value),console.log("selectedFile:",(s=n.value)==null?void 0:s.name),console.log("selectedSavedImage:",(t=x.value)==null?void 0:t.name),console.log("TEST_MODE:",y),o.value==="image"){if(!x.value){u.value="Please select a saved image";return}c.value=x.value.parsedText||"",f.value=c.value,d.value=x.value.sections||[],C.value=x.value.confidence||null,v.value="Loaded saved menu image!",setTimeout(()=>{v.value=""},3e3);return}if(o.value==="csv"){await $();return}if(!n.value){u.value="Please select an image file first",console.error("‚ùå No file selected");return}o.value!=="ocr"&&(console.log("‚ö†Ô∏è Upload method was not OCR, switching to OCR"),o.value="ocr"),console.log("‚úÖ Calling uploadAndParse..."),await L()},$=async()=>{if(n.value){b.value=!0,u.value="",v.value="",d.value=[];try{const s=await n.value.text(),t=se(s);d.value=t,c.value=t.map(r=>`${r.name}
${r.items.map(m=>`  ${m.name}${m.description?" - "+m.description:""} $${m.price.toFixed(2)}`).join(`
`)}`).join(`

`),f.value=c.value,t.length===0?u.value="No valid menu items found in CSV. Please check the format.":(v.value=`Successfully parsed ${t.length} section(s) with ${T.value} item(s)!`,setTimeout(()=>{v.value=""},3e3))}catch(s){console.error("CSV parsing failed:",s),u.value=s.message||"Failed to parse CSV file. Please check the format."}finally{b.value=!1}}},L=async()=>{if(console.log("=== uploadAndParse START ==="),!n.value){u.value="Please select an image file first",console.error("‚ùå No file selected");return}if(console.log("File selected:",n.value.name,n.value.size,"bytes"),console.log("TEST_MODE value:",y),console.log("TEST_MODE type:",typeof y),!y){const s="OCR in test mode requires TEST_MODE to be enabled. Current value: "+y+". Please check your .env file has VITE_TEST_MODE=true";u.value=s,console.error("‚ùå TEST_MODE is false:",s);return}console.log("‚úÖ TEST_MODE is enabled, proceeding with OCR..."),b.value=!0,_.value=0,u.value="",v.value="",d.value=[];try{console.log("üì∏ Starting OCR processing for file:",n.value.name,"TEST_MODE:",y);const s=await ae.parseMenuImage(n.value,r=>{console.log("OCR progress:",r+"%"),_.value=r});console.log("OCR response received:",s),_.value=100,c.value=s.data.parsedText||"",f.value=c.value,C.value=s.data.confidence||null,d.value=s.data.sections||[];const t={id:Date.now().toString(),name:n.value.name,date:new Date().toISOString(),preview:URL.createObjectURL(n.value),parsedText:c.value,sections:d.value,confidence:C.value};w.value.unshift(t),w.value.length>10&&(w.value=w.value.slice(0,10)),c.value.trim()?d.value.length===0?v.value="Text extracted! Could not auto-parse menu structure. You can edit the text below.":(v.value=`Successfully parsed ${d.value.length} section(s) with ${T.value} item(s)!`,setTimeout(()=>{v.value=""},3e3)):u.value="No text found in image. Please try a clearer image with visible text."}catch(s){console.error("OCR parsing failed:",s),u.value=s.message||"Failed to parse menu. Please try again with a clearer image."}finally{b.value=!1}},B=s=>{x.value=s},N=()=>{const s=`name,price,description,category
Espresso,3.50,Rich and bold coffee,Coffee
Cappuccino,4.50,Espresso with steamed milk,Coffee
Croissant,3.00,Buttery French pastry,Pastry`,t=new Blob([s],{type:"text/csv"}),r=URL.createObjectURL(t),m=document.createElement("a");m.href=r,m.download="menu_template.csv",m.click(),URL.revokeObjectURL(r)},j=s=>new Date(s).toLocaleDateString(),z=()=>{confirm("Clear the parsed text?")&&(c.value="",f.value="",C.value=null,n.value=null,x.value=null,_.value=0,d.value=[])},A=()=>{if(!f.value.trim()&&d.value.length===0){u.value="Menu text is empty";return}f.value.trim()&&f.value!==c.value&&(d.value=te(f.value),c.value=f.value),v.value=`Menu parsed successfully! Found ${d.value.length} section(s) with ${T.value} item(s). You can edit the text above if needed.`,setTimeout(()=>{v.value=""},5e3)},q=()=>{D.push("/dashboard")};return(s,t)=>(l(),a("div",le,[e("div",{class:"bg-white shadow-sm"},[e("div",{class:"container mx-auto px-4 py-4"},[e("div",{class:"flex items-center justify-between"},[e("button",{onClick:q,class:"text-gray-600 hover:text-gray-900"},[...t[4]||(t[4]=[e("span",{class:"text-2xl"},"‚Üê",-1)])]),t[5]||(t[5]=e("h1",{class:"text-xl font-bold text-gray-900"},"OCR Menu Import",-1)),t[6]||(t[6]=e("div",{class:"w-8"},null,-1))])])]),e("div",oe,[t[21]||(t[21]=Y('<div class="card bg-blue-50 border border-blue-200 mb-6" data-v-addf7e48><h3 class="font-bold text-blue-900 mb-2" data-v-addf7e48>üì∏ Menu Import Options</h3><ul class="text-sm text-blue-800 space-y-1" data-v-addf7e48><li data-v-addf7e48>‚Ä¢ <strong data-v-addf7e48>Live OCR Scan:</strong> Upload a photo and extract text automatically</li><li data-v-addf7e48>‚Ä¢ <strong data-v-addf7e48>Pre-Tested Image:</strong> Use a previously verified menu image</li><li data-v-addf7e48>‚Ä¢ <strong data-v-addf7e48>CSV Upload:</strong> Import from a spreadsheet file</li><li data-v-addf7e48>‚Ä¢ Review and edit the parsed menu before saving</li></ul></div>',1)),e("div",re,[t[10]||(t[10]=e("h3",{class:"font-bold text-gray-900 mb-4"},"Select Import Method",-1)),e("div",ne,[e("button",{onClick:t[0]||(t[0]=r=>o.value="ocr"),class:k(["p-4 border-2 rounded-lg transition-all text-left",o.value==="ocr"?"border-primary-500 bg-primary-50":"border-gray-300 hover:border-primary-300"])},[...t[7]||(t[7]=[e("div",{class:"text-2xl mb-2"},"üì∑",-1),e("h4",{class:"font-semibold text-gray-900 mb-1"},"Live OCR Scan",-1),e("p",{class:"text-xs text-gray-600"},"Upload photo for text extraction",-1)])],2),e("button",{onClick:t[1]||(t[1]=r=>o.value="image"),class:k(["p-4 border-2 rounded-lg transition-all text-left",o.value==="image"?"border-primary-500 bg-primary-50":"border-gray-300 hover:border-primary-300"])},[...t[8]||(t[8]=[e("div",{class:"text-2xl mb-2"},"üñºÔ∏è",-1),e("h4",{class:"font-semibold text-gray-900 mb-1"},"Pre-Tested Image",-1),e("p",{class:"text-xs text-gray-600"},"Use verified menu image",-1)])],2),e("button",{onClick:t[2]||(t[2]=r=>o.value="csv"),class:k(["p-4 border-2 rounded-lg transition-all text-left",o.value==="csv"?"border-primary-500 bg-primary-50":"border-gray-300 hover:border-primary-300"])},[...t[9]||(t[9]=[e("div",{class:"text-2xl mb-2"},"üìä",-1),e("h4",{class:"font-semibold text-gray-900 mb-1"},"CSV Upload",-1),e("p",{class:"text-xs text-gray-600"},"Import from spreadsheet",-1)])],2)])]),e("div",ie,[e("h3",de,[o.value==="ocr"?(l(),a("span",ue,"Upload Menu Image for OCR")):o.value==="image"?(l(),a("span",ce,"Select Pre-Tested Image")):o.value==="csv"?(l(),a("span",ve,"Upload CSV File")):(l(),a("span",me,"Upload Menu"))]),o.value==="image"?(l(),a("div",pe,[w.value.length===0?(l(),a("div",ge,[...t[11]||(t[11]=[e("div",{class:"text-4xl mb-2"},"üìö",-1),e("p",{class:"text-gray-600 mb-2"},"No saved menu images yet",-1),e("p",{class:"text-sm text-gray-500"},"Upload images using OCR Scan to build your library",-1)])])):(l(),a("div",fe,[(l(!0),a(S,null,M(w.value,(r,m)=>{var h;return l(),a("div",{key:m,onClick:O=>B(r),class:k(["border-2 rounded-lg p-3 cursor-pointer transition-all",((h=x.value)==null?void 0:h.id)===r.id?"border-primary-500 bg-primary-50":"border-gray-300 hover:border-primary-300"])},[e("img",{src:r.preview,alt:"Menu",class:"w-full h-32 object-cover rounded mb-2"},null,8,be),e("p",ye,i(r.name),1),e("p",he,i(j(r.date)),1)],10,xe)}),128))]))])):g("",!0),o.value==="ocr"||o.value==="csv"?(l(),a("div",_e,[e("label",{class:k(["block w-full cursor-pointer",{"opacity-50":b.value}])},[e("div",Ce,[n.value?(l(),a("div",Me,[t[12]||(t[12]=e("div",{class:"text-4xl"},"‚úÖ",-1)),e("p",Oe,i(n.value.name),1),e("p",Ee,i(F(n.value.size)),1)])):(l(),a("div",we,[e("div",ke,i(o.value==="csv"?"üìä":"üì∑"),1),e("p",Te,i(o.value==="csv"?"Click to upload CSV file":"Click to upload menu image"),1),e("p",Se,i(o.value==="csv"?"CSV file (name, price, description, category)":"PNG, JPG up to 10MB"),1)]))]),e("input",{type:"file",accept:o.value==="csv"?".csv":"image/*",class:"hidden",onChange:I,disabled:b.value},null,40,Re)],2),o.value==="csv"?(l(),a("div",Pe,[e("a",{href:"#",onClick:J(N,["prevent"]),class:"text-sm text-primary-600 hover:underline"}," üì• Download CSV Template ")])):g("",!0)])):g("",!0),n.value&&!c.value||o.value==="image"&&x.value?(l(),a("button",{key:2,onClick:V,disabled:b.value,class:"w-full btn btn-primary disabled:opacity-50"},[b.value?(l(),a("span",Ie,"Processing... "+i(_.value)+"%",1)):o.value==="image"?(l(),a("span",Fe,"Load Selected Image")):o.value==="csv"?(l(),a("span",Ve,"Parse CSV")):(l(),a("span",Ue,"Parse Menu"))],8,De)):g("",!0),n.value?(l(),a("div",$e,[e("p",null,[t[13]||(t[13]=e("strong",null,"Debug:",-1)),W(" File: "+i(n.value.name)+", Method: "+i(o.value)+", TEST_MODE: "+i(H(y)),1)])])):g("",!0)]),b.value?(l(),a("div",Le,[e("div",Be,[t[14]||(t[14]=e("div",{class:"text-4xl mb-2"},"‚è≥",-1)),t[15]||(t[15]=e("p",{class:"font-medium text-yellow-900"},"Processing your menu...",-1)),t[16]||(t[16]=e("p",{class:"text-sm text-yellow-700"},"This may take a few moments",-1)),e("div",Ne,[e("div",{class:"bg-yellow-600 h-full transition-all duration-300",style:Q({width:`${_.value}%`})},null,4)])])])):g("",!0),c.value?(l(),a("div",je,[e("div",ze,[t[17]||(t[17]=e("h3",{class:"font-bold text-gray-900"},"Extracted Text",-1)),C.value?(l(),a("span",Ae," Confidence: "+i((C.value*100).toFixed(0))+"% ",1)):g("",!0)]),X(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=r=>f.value=r),rows:"8",class:"input font-mono text-sm resize-none mb-4",placeholder:"Raw extracted text..."},null,512),[[Z,f.value]]),d.value&&d.value.length>0?(l(),a("div",qe,[t[18]||(t[18]=e("h4",{class:"font-bold text-gray-900 mb-3"},"üìã Parsed Menu Structure",-1)),e("p",Ge," Found "+i(d.value.length)+" section(s) with "+i(T.value)+" item(s) ",1),e("div",Ke,[(l(!0),a(S,null,M(d.value,(r,m)=>(l(),a("div",{key:m,class:"bg-gray-50 rounded-lg p-3"},[e("h5",Ye,i(r.name),1),e("div",Je,[(l(!0),a(S,null,M(r.items,(h,O)=>(l(),a("div",{key:O,class:"text-sm bg-white p-2 rounded border border-gray-200"},[e("div",We,[e("div",He,[e("p",Qe,i(h.name),1),h.description?(l(),a("p",Xe,i(h.description),1)):g("",!0)]),e("span",Ze,"$"+i(h.price.toFixed(2)),1)])]))),128))])]))),128))])])):g("",!0),e("div",{class:"mt-4 flex gap-2"},[e("button",{onClick:A,class:"flex-1 btn btn-primary"}," Save Menu "),e("button",{onClick:z,class:"flex-1 btn btn-secondary"}," Clear ")])])):g("",!0),E(P,{name:"fade"},{default:R(()=>[v.value?(l(),a("div",et,[e("div",tt,[t[19]||(t[19]=e("div",{class:"text-4xl mb-2"},"‚úÖ",-1)),e("p",st,i(v.value),1)])])):g("",!0)]),_:1}),E(P,{name:"fade"},{default:R(()=>[u.value?(l(),a("div",at,[e("div",lt,[t[20]||(t[20]=e("div",{class:"text-4xl mb-2"},"‚ö†Ô∏è",-1)),e("p",ot,i(u.value),1)])])):g("",!0)]),_:1}),t[22]||(t[22]=e("div",{class:"card bg-gray-50"},[e("h3",{class:"font-bold text-gray-900 mb-2"},"üí° Tips for Best Results"),e("ul",{class:"text-sm text-gray-700 space-y-1"},[e("li",null,"‚Ä¢ Ensure good lighting and focus"),e("li",null,"‚Ä¢ Avoid shadows and glare"),e("li",null,"‚Ä¢ Capture text horizontally"),e("li",null,"‚Ä¢ Use high resolution images"),e("li",null,"‚Ä¢ Review and edit the parsed text before saving")])],-1))])]))}},ct=G(rt,[["__scopeId","data-v-addf7e48"]]);export{ct as default};
