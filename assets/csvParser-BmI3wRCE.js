import{T as X,D as ae}from"./index-Dpv-nFGf.js";import{g as me}from"./_commonjsHelpers-Cpj98o6Y.js";var ye={exports:{}};(function(e){var t=function(a){var s=Object.prototype,f=s.hasOwnProperty,w=Object.defineProperty||function(o,r,i){o[r]=i.value},g,u=typeof Symbol=="function"?Symbol:{},d=u.iterator||"@@iterator",C=u.asyncIterator||"@@asyncIterator",k=u.toStringTag||"@@toStringTag";function l(o,r,i){return Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}),o[r]}try{l({},"")}catch{l=function(r,i,h){return r[i]=h}}function p(o,r,i,h){var n=r&&r.prototype instanceof m?r:m,c=Object.create(n.prototype),L=new H(h||[]);return w(c,"_invoke",{value:Z(o,i,L)}),c}a.wrap=p;function y(o,r,i){try{return{type:"normal",arg:o.call(r,i)}}catch(h){return{type:"throw",arg:h}}}var v="suspendedStart",b="suspendedYield",A="executing",_="completed",O={};function m(){}function T(){}function R(){}var D={};l(D,d,function(){return this});var U=Object.getPrototypeOf,z=U&&U(U(K([])));z&&z!==s&&f.call(z,d)&&(D=z);var $=R.prototype=m.prototype=Object.create(D);T.prototype=R,w($,"constructor",{value:R,configurable:!0}),w(R,"constructor",{value:T,configurable:!0}),T.displayName=l(R,k,"GeneratorFunction");function Y(o){["next","throw","return"].forEach(function(r){l(o,r,function(i){return this._invoke(r,i)})})}a.isGeneratorFunction=function(o){var r=typeof o=="function"&&o.constructor;return r?r===T||(r.displayName||r.name)==="GeneratorFunction":!1},a.mark=function(o){return Object.setPrototypeOf?Object.setPrototypeOf(o,R):(o.__proto__=R,l(o,k,"GeneratorFunction")),o.prototype=Object.create($),o},a.awrap=function(o){return{__await:o}};function B(o,r){function i(c,L,E,S){var I=y(o[c],o,L);if(I.type==="throw")S(I.arg);else{var G=I.arg,P=G.value;return P&&typeof P=="object"&&f.call(P,"__await")?r.resolve(P.__await).then(function(N){i("next",N,E,S)},function(N){i("throw",N,E,S)}):r.resolve(P).then(function(N){G.value=N,E(G)},function(N){return i("throw",N,E,S)})}}var h;function n(c,L){function E(){return new r(function(S,I){i(c,L,S,I)})}return h=h?h.then(E,E):E()}w(this,"_invoke",{value:n})}Y(B.prototype),l(B.prototype,C,function(){return this}),a.AsyncIterator=B,a.async=function(o,r,i,h,n){n===void 0&&(n=Promise);var c=new B(p(o,r,i,h),n);return a.isGeneratorFunction(r)?c:c.next().then(function(L){return L.done?L.value:c.next()})};function Z(o,r,i){var h=v;return function(c,L){if(h===A)throw new Error("Generator is already running");if(h===_){if(c==="throw")throw L;return J()}for(i.method=c,i.arg=L;;){var E=i.delegate;if(E){var S=x(E,i);if(S){if(S===O)continue;return S}}if(i.method==="next")i.sent=i._sent=i.arg;else if(i.method==="throw"){if(h===v)throw h=_,i.arg;i.dispatchException(i.arg)}else i.method==="return"&&i.abrupt("return",i.arg);h=A;var I=y(o,r,i);if(I.type==="normal"){if(h=i.done?_:b,I.arg===O)continue;return{value:I.arg,done:i.done}}else I.type==="throw"&&(h=_,i.method="throw",i.arg=I.arg)}}}function x(o,r){var i=r.method,h=o.iterator[i];if(h===g)return r.delegate=null,i==="throw"&&o.iterator.return&&(r.method="return",r.arg=g,x(o,r),r.method==="throw")||i!=="return"&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+i+"' method")),O;var n=y(h,o.iterator,r.arg);if(n.type==="throw")return r.method="throw",r.arg=n.arg,r.delegate=null,O;var c=n.arg;if(!c)return r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,O;if(c.done)r[o.resultName]=c.value,r.next=o.nextLoc,r.method!=="return"&&(r.method="next",r.arg=g);else return c;return r.delegate=null,O}Y($),l($,k,"Generator"),l($,d,function(){return this}),l($,"toString",function(){return"[object Generator]"});function Q(o){var r={tryLoc:o[0]};1 in o&&(r.catchLoc=o[1]),2 in o&&(r.finallyLoc=o[2],r.afterLoc=o[3]),this.tryEntries.push(r)}function j(o){var r=o.completion||{};r.type="normal",delete r.arg,o.completion=r}function H(o){this.tryEntries=[{tryLoc:"root"}],o.forEach(Q,this),this.reset(!0)}a.keys=function(o){var r=Object(o),i=[];for(var h in r)i.push(h);return i.reverse(),function n(){for(;i.length;){var c=i.pop();if(c in r)return n.value=c,n.done=!1,n}return n.done=!0,n}};function K(o){if(o){var r=o[d];if(r)return r.call(o);if(typeof o.next=="function")return o;if(!isNaN(o.length)){var i=-1,h=function n(){for(;++i<o.length;)if(f.call(o,i))return n.value=o[i],n.done=!1,n;return n.value=g,n.done=!0,n};return h.next=h}}return{next:J}}a.values=K;function J(){return{value:g,done:!0}}return H.prototype={constructor:H,reset:function(o){if(this.prev=0,this.next=0,this.sent=this._sent=g,this.done=!1,this.delegate=null,this.method="next",this.arg=g,this.tryEntries.forEach(j),!o)for(var r in this)r.charAt(0)==="t"&&f.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=g)},stop:function(){this.done=!0;var o=this.tryEntries[0],r=o.completion;if(r.type==="throw")throw r.arg;return this.rval},dispatchException:function(o){if(this.done)throw o;var r=this;function i(S,I){return c.type="throw",c.arg=o,r.next=S,I&&(r.method="next",r.arg=g),!!I}for(var h=this.tryEntries.length-1;h>=0;--h){var n=this.tryEntries[h],c=n.completion;if(n.tryLoc==="root")return i("end");if(n.tryLoc<=this.prev){var L=f.call(n,"catchLoc"),E=f.call(n,"finallyLoc");if(L&&E){if(this.prev<n.catchLoc)return i(n.catchLoc,!0);if(this.prev<n.finallyLoc)return i(n.finallyLoc)}else if(L){if(this.prev<n.catchLoc)return i(n.catchLoc,!0)}else if(E){if(this.prev<n.finallyLoc)return i(n.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(o,r){for(var i=this.tryEntries.length-1;i>=0;--i){var h=this.tryEntries[i];if(h.tryLoc<=this.prev&&f.call(h,"finallyLoc")&&this.prev<h.finallyLoc){var n=h;break}}n&&(o==="break"||o==="continue")&&n.tryLoc<=r&&r<=n.finallyLoc&&(n=null);var c=n?n.completion:{};return c.type=o,c.arg=r,n?(this.method="next",this.next=n.finallyLoc,O):this.complete(c)},complete:function(o,r){if(o.type==="throw")throw o.arg;return o.type==="break"||o.type==="continue"?this.next=o.arg:o.type==="return"?(this.rval=this.arg=o.arg,this.method="return",this.next="end"):o.type==="normal"&&r&&(this.next=r),O},finish:function(o){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.finallyLoc===o)return this.complete(i.completion,i.afterLoc),j(i),O}},catch:function(o){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc===o){var h=i.completion;if(h.type==="throw"){var n=h.arg;j(i)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(o,r,i){return this.delegate={iterator:K(o),resultName:r,nextLoc:i},this.method==="next"&&(this.arg=g),O}},a}(e.exports);try{regeneratorRuntime=t}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}})(ye);var ne=(e,t)=>`${e}-${t}-${Math.random().toString(16).slice(3,8)}`;const ve=ne;let ie=0;var de=({id:e,action:t,payload:a={}})=>{let s=e;return typeof s>"u"&&(s=ve("Job",ie),ie+=1),{id:s,action:t,payload:a}},W={};let oe=!1;W.logging=oe;W.setLogging=e=>{oe=e};W.log=(...e)=>oe?console.log.apply(void 0,e):null;const we=de,{log:V}=W,be=ne;let se=0;var Le=()=>{const e=be("Scheduler",se),t={},a={};let s=[];se+=1;const f=()=>s.length,w=()=>Object.keys(t).length,g=()=>{if(s.length!==0){const l=Object.keys(t);for(let p=0;p<l.length;p+=1)if(typeof a[l[p]]>"u"){s[0](t[l[p]]);break}}},u=(l,p)=>new Promise((y,v)=>{const b=we({action:l,payload:p});s.push(async A=>{s.shift(),a[A.id]=b;try{y(await A[l].apply(void 0,[...p,b.id]))}catch(_){v(_)}finally{delete a[A.id],g()}}),V(`[${e}]: Add ${b.id} to JobQueue`),V(`[${e}]: JobQueue length=${s.length}`),g()});return{addWorker:l=>(t[l.id]=l,V(`[${e}]: Add ${l.id}`),V(`[${e}]: Number of workers=${w()}`),g(),l.id),addJob:async(l,...p)=>{if(w()===0)throw Error(`[${e}]: You need to have at least one worker before adding jobs`);return u(l,p)},terminate:async()=>{Object.keys(t).forEach(async l=>{await t[l].terminate()}),s=[]},getQueueLen:f,getNumWorkers:w}};function Ee(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}function Se(){return!!(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0)}var Oe=Se;const Te=Oe;var ke=e=>{const t={};return typeof WorkerGlobalScope<"u"?t.type="webworker":Te()?t.type="electron":typeof document=="object"?t.type="browser":typeof process=="object"&&typeof Ee=="function"&&(t.type="node"),typeof e>"u"?t:t[e]};const Ae=ke("type")==="browser",Re=Ae?e=>new URL(e,window.location.href).href:e=>e;var Ie=e=>{const t={...e};return["corePath","workerPath","langPath"].forEach(a=>{e[a]&&(t[a]=Re(t[a]))}),t},Ce=e=>{const t=[],a=[],s=[],f=[],w=[];return e.blocks&&e.blocks.forEach(g=>{g.paragraphs.forEach(u=>{u.lines.forEach(d=>{d.words.forEach(C=>{C.symbols.forEach(k=>{w.push({...k,page:e,block:g,paragraph:u,line:d,word:C})}),f.push({...C,page:e,block:g,paragraph:u,line:d})}),s.push({...d,page:e,block:g,paragraph:u})}),a.push({...u,page:e,block:g})}),t.push({...g,page:e})}),{...e,blocks:t,paragraphs:a,lines:s,words:f,symbols:w}},pe={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3};const _e="5.1.1",Me={version:_e};var $e={workerBlobURL:!0,logger:()=>{}};const Pe=Me.version,Ne=$e;var De={...Ne,workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${Pe}/dist/worker.min.js`},ze=({workerPath:e,workerBlobURL:t})=>{let a;if(Blob&&URL&&t){const s=new Blob([`importScripts("${e}");`],{type:"application/javascript"});a=new Worker(URL.createObjectURL(s))}else a=new Worker(e);return a},Ge=e=>{e.terminate()},Ue=(e,t)=>{e.onmessage=({data:a})=>{t(a)}},je=async(e,t)=>{e.postMessage(t)};const ee=e=>new Promise((t,a)=>{const s=new FileReader;s.onload=()=>{t(s.result)},s.onerror=({target:{error:{code:f}}})=>{a(Error(`File could not be read! Code=${f}`))},s.readAsArrayBuffer(e)}),re=async e=>{let t=e;if(typeof e>"u")return"undefined";if(typeof e=="string")/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(e)?t=atob(e.split(",")[1]).split("").map(a=>a.charCodeAt(0)):t=await(await fetch(e)).arrayBuffer();else if(typeof HTMLElement<"u"&&e instanceof HTMLElement)e.tagName==="IMG"&&(t=await re(e.src)),e.tagName==="VIDEO"&&(t=await re(e.poster)),e.tagName==="CANVAS"&&await new Promise(a=>{e.toBlob(async s=>{t=await ee(s),a()})});else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas){const a=await e.convertToBlob();t=await ee(a)}else(e instanceof File||e instanceof Blob)&&(t=await ee(e));return new Uint8Array(t)};var Fe=re;const Be=De,We=ze,xe=Ge,He=Ue,Ke=je,Ye=Fe;var Je={defaultOptions:Be,spawnWorker:We,terminateWorker:xe,onMessage:He,send:Ke,loadImage:Ye};const Ve=Ie,qe=Ce,M=de,{log:ce}=W,Ze=ne,F=pe,{defaultOptions:Qe,spawnWorker:Xe,terminateWorker:et,onMessage:tt,loadImage:le,send:rt}=Je;let ue=0;var he=async(e="eng",t=F.LSTM_ONLY,a={},s={})=>{const f=Ze("Worker",ue),{logger:w,errorHandler:g,...u}=Ve({...Qe,...a}),d={},C={},k=typeof e=="string"?e.split("+"):e;let l=t,p=s;const y=[F.DEFAULT,F.LSTM_ONLY].includes(t)&&!u.legacyCore;let v,b;const A=new Promise((n,c)=>{b=n,v=c}),_=n=>{v(n.message)};let O=Xe(u);O.onerror=_,ue+=1;const m=(n,c)=>{d[n]=c},T=(n,c)=>{C[n]=c},R=({id:n,action:c,payload:L})=>new Promise((E,S)=>{ce(`[${f}]: Start ${n}, action=${c}`);const I=`${c}-${n}`;m(I,E),T(I,S),rt(O,{workerId:f,jobId:n,action:c,payload:L})}),D=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),U=n=>R(M({id:n,action:"load",payload:{options:{lstmOnly:y,corePath:u.corePath,logging:u.logging}}})),z=(n,c,L)=>R(M({id:L,action:"FS",payload:{method:"writeFile",args:[n,c]}})),$=(n,c)=>R(M({id:c,action:"FS",payload:{method:"readFile",args:[n,{encoding:"utf8"}]}})),Y=(n,c)=>R(M({id:c,action:"FS",payload:{method:"unlink",args:[n]}})),B=(n,c,L)=>R(M({id:L,action:"FS",payload:{method:n,args:c}})),Z=()=>console.warn("`loadLanguage` is depreciated and should be removed from code (workers now come with language pre-loaded)"),x=(n,c)=>R(M({id:c,action:"loadLanguage",payload:{langs:n,options:{langPath:u.langPath,dataPath:u.dataPath,cachePath:u.cachePath,cacheMethod:u.cacheMethod,gzip:u.gzip,lstmOnly:[F.DEFAULT,F.LSTM_ONLY].includes(l)&&!u.legacyLang}}})),Q=()=>console.warn("`initialize` is depreciated and should be removed from code (workers now come pre-initialized)"),j=(n,c,L,E)=>R(M({id:E,action:"initialize",payload:{langs:n,oem:c,config:L}})),H=(n="eng",c,L,E)=>{if(y&&[F.TESSERACT_ONLY,F.TESSERACT_LSTM_COMBINED].includes(c))throw Error("Legacy model requested but code missing.");const S=c||l;l=S;const I=L||p;p=I;const P=(typeof n=="string"?n.split("+"):n).filter(N=>!k.includes(N));return k.push(...P),P.length>0?x(P,E).then(()=>j(n,S,I,E)):j(n,S,I,E)},K=(n={},c)=>R(M({id:c,action:"setParameters",payload:{params:n}})),J=async(n,c={},L={blocks:!0,text:!0,hocr:!0,tsv:!0},E)=>R(M({id:E,action:"recognize",payload:{image:await le(n),options:c,output:L}})),o=(n="Tesseract OCR Result",c=!1,L)=>(console.log("`getPDF` function is depreciated. `recognize` option `savePDF` should be used instead."),R(M({id:L,action:"getPDF",payload:{title:n,textonly:c}}))),r=async(n,c)=>{if(y)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return R(M({id:c,action:"detect",payload:{image:await le(n)}}))},i=async()=>(O!==null&&(et(O),O=null),Promise.resolve());tt(O,({workerId:n,jobId:c,status:L,action:E,data:S})=>{const I=`${E}-${c}`;if(L==="resolve"){ce(`[${n}]: Complete ${c}`);let G=S;E==="recognize"?G=qe(S):E==="getPDF"&&(G=Array.from({...S,length:Object.keys(S).length})),d[I]({jobId:c,data:G})}else if(L==="reject")if(C[I](S),E==="load"&&v(S),g)g(S);else throw Error(S);else L==="progress"&&w({...S,userJobId:c})});const h={id:f,worker:O,setResolve:m,setReject:T,load:D,writeText:z,readText:$,removeFile:Y,FS:B,loadLanguage:Z,initialize:Q,reinitialize:H,setParameters:K,recognize:J,getPDF:o,detect:r,terminate:i};return U().then(()=>x(e)).then(()=>j(e,t,s)).then(()=>b(h)).catch(()=>{}),A};const ge=he,nt=async(e,t,a)=>{const s=await ge(t,1,a);return s.recognize(e).finally(async()=>{await s.terminate()})},ot=async(e,t)=>{const a=await ge("osd",0,t);return a.detect(e).finally(async()=>{await a.terminate()})};var at={recognize:nt,detect:ot},it={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"},st={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"};const ct=Le,lt=he,ut=at,ft=it,dt=pe,pt=st,{setLogging:ht}=W;var gt={languages:ft,OEM:dt,PSM:pt,createScheduler:ct,createWorker:lt,setLogging:ht,...ut};const mt=me(gt);function yt(e){const t=e.split(`
`).filter(g=>g.trim().length>0),a=[];let s=null;const f=["breakfast","lunch","dinner","appetizers","starters","mains","entrees","desserts","beverages","drinks","sides","salads","burgers","sandwiches","panini","pasta","pizza","sweets"],w=/[\$S]\s*\d+\.?\d*|\d+\.\d{2}|\d+\s*$/g;return t.forEach((g,u)=>{const d=g.trim();if(!d)return;const C=d===d.toUpperCase()&&d.length>3,k=f.some(y=>d.toLowerCase().includes(y)),l=C||k,p=!w.test(d);if(l&&p)s&&s.items.length>0&&a.push(s),s={name:d,items:[]};else if(s){const y=d.match(w);let v=0;if(y&&y.length>0){let m=y[y.length-1];if(m=m.replace(/[\$S]/g,"").trim(),/^\d{3,}$/.test(m)&&m.length>=3){const R=m.slice(0,-2)+"."+m.slice(-2);parseFloat(R)<50&&(m=R)}v=parseFloat(m)||0}let b=d;y&&y.forEach(m=>{b=b.replace(m,"").trim()}),b=b.replace(/[\$S]\s*\d+\.?\d*\s*$/,"").trim(),b=b.replace(/[\$S]\s*$/,"").trim(),b=b.replace(/\bwrop\b/gi,"wrap").replace(/\bsalod\b/gi,"salad").replace(/\bfomato\b/gi,"tomato").replace(/\bfom\b/gi,"tomato").replace(/\bmi\b/gi,"mix").replace(/\bmis\b/gi,"mix").replace(/\bSchritzel\b/gi,"Schnitzel").replace(/\bGriled\b/gi,"Grilled").replace(/\bGr nica\b/gi,"Avocado").replace(/\bChien\b/gi,"Chicken").replace(/\bFrito\b/gi,"Frittata").replace(/\bGlten\b/gi,"Gluten").replace(/\bFata\b/gi,"Frittata").replace(/\bPriam tok i\b/gi,"Premium steak pie").replace(/\bleck\b/gi,"leek").replace(/\bPastie\b/gi,"Pastry").replace(/\bfetta\b/gi,"feta").replace(/\broll\b/gi,"rolls").replace(/\bletuce\b/gi,"lettuce").replace(/\bpaty\b/gi,"patty").replace(/\bchill\b/gi,"chilli").replace(/\bMarincted\b/gi,"Marinated").replace(/\bwih\b/gi,"with").replace(/\bPrt\b/gi,"Perri").replace(/\bBreaky\b/gi,"Breakfast").replace(/\bhumous\b/gi,"hummus").replace(/\bpast\b/gi,"paste");const A=b.split(/[-â€“â€”\/]/).map(m=>m.trim()).filter(m=>m),_=A[0]||b.trim(),O=A.slice(1).join(" ").trim()||"";if(_&&_.length>2&&v>0&&v<=200){const m=_.trim(),T=m.length,R=(m.match(/[^a-zA-Z0-9\s]/g)||[]).length,D=T>0?R/T:0,U=(m.match(/[a-zA-Z]/g)||[]).length,z=T>0?U/T:0;(D<.3&&z>=.4||T<=3)&&(/[a-zA-Z]{2,}/.test(m)||T<=4)&&s.items.push({name:m,description:O.trim(),price:v,available:!0})}}else s={name:"Menu Items",items:[]}}),s&&s.items.length>0&&a.push(s),a}async function vt(e,t={}){const{grayscale:a=!0,enhanceContrast:s=!0,denoise:f=!0,threshold:w=!0,resize:g=!0,maxWidth:u=2e3,maxHeight:d=2e3,thresholdValue:C=128,contrastLevel:k=1.2}=t;return console.log("ðŸ–¼ï¸ Starting image preprocessing...",{options:t}),new Promise((l,p)=>{try{const y=new Image;if(y.onload=()=>{try{let v=document.createElement("canvas"),b=v.getContext("2d"),A=y.width,_=y.height;if(g&&(A>u||_>d)){const T=Math.min(u/A,d/_);A=Math.round(A*T),_=Math.round(_*T)}v.width=A,v.height=_,b.drawImage(y,0,0,A,_);let O=b.getImageData(0,0,A,_),m=O.data;a&&(m=wt(m)),s&&(m=bt(m,k)),f&&(m=Lt(m,A,_)),w&&a&&(m=Et(m,C)),O.data.set(m),b.putImageData(O,0,0),v.toBlob(T=>{T?(console.log("âœ… Image preprocessing complete"),l(T)):p(new Error("Failed to create blob from processed image"))},"image/png",.95)}catch(v){p(v)}},y.onerror=()=>{p(new Error("Failed to load image"))},e instanceof File){const v=new FileReader;v.onload=b=>{y.src=b.target.result},v.onerror=()=>p(new Error("Failed to read image file")),v.readAsDataURL(e)}else e instanceof HTMLImageElement?y.src=e.src:e instanceof HTMLCanvasElement?y.src=e.toDataURL():p(new Error("Unsupported image source type"))}catch(y){p(y)}})}function wt(e){for(let t=0;t<e.length;t+=4){const a=.299*e[t]+.587*e[t+1]+.114*e[t+2];e[t]=a,e[t+1]=a,e[t+2]=a}return e}function bt(e,t){const a=259*(t*255+255)/(255*(259-t*255));for(let s=0;s<e.length;s+=4)e[s]=te(a*(e[s]-128)+128),e[s+1]=te(a*(e[s+1]-128)+128),e[s+2]=te(a*(e[s+2]-128)+128);return e}function Lt(e,t,a){const s=new Uint8ClampedArray(e.length),f=1;for(let w=0;w<a;w++)for(let g=0;g<t;g++){const u=(w*t+g)*4,d=[];for(let k=-f;k<=f;k++)for(let l=-f;l<=f;l++){const p=g+l,y=w+k;if(p>=0&&p<t&&y>=0&&y<a){const v=(y*t+p)*4;d.push(e[v])}}d.sort((k,l)=>k-l);const C=d[Math.floor(d.length/2)];s[u]=C,s[u+1]=C,s[u+2]=C,s[u+3]=e[u+3]}return s}function Et(e,t){for(let a=0;a<e.length;a+=4){const f=e[a]>t?255:0;e[a]=f,e[a+1]=f,e[a+2]=f}return e}function te(e){return Math.max(0,Math.min(255,Math.round(e)))}const Tt={async parseMenuImage(e,t,a={}){const{enablePreprocessing:s=!0,preprocessingOptions:f={}}=a;if(console.log("=== OCR Service Called ==="),console.log("TEST_MODE:",X),console.log("Image file:",e==null?void 0:e.name,e==null?void 0:e.size),X){console.log("âœ… Using TEST_MODE - Tesseract.js OCR");try{console.log("Starting OCR with Tesseract.js...",{fileName:e.name,fileSize:e.size}),t&&t(5);let u=e;if(s){console.log("ðŸ–¼ï¸ Preprocessing image for OCR..."),t&&t(8);try{const l={grayscale:!0,enhanceContrast:!0,denoise:!0,threshold:!0,resize:!0,maxWidth:2e3,maxHeight:2e3,thresholdValue:128,contrastLevel:1.2,...f},p=await vt(e,l);u=new File([p],e.name,{type:"image/png",lastModified:Date.now()}),console.log("âœ… Image preprocessing complete"),t&&t(10)}catch(l){console.warn("âš ï¸ Image preprocessing failed, using original image:",l),u=e}}else console.log("â­ï¸ Image preprocessing disabled, using original image"),t&&t(10);const d=await mt.recognize(u,"eng",{logger:l=>{if(console.log("Tesseract progress:",l),t){let p=10;l.status==="loading tesseract core"?p=15:l.status==="initializing tesseract"?p=25:l.status==="loading language traineddata"?p=35:l.status==="initializing api"?p=45:l.status==="recognizing text"?p=50+Math.round(l.progress*45):l.status==="complete"&&(p=100),p>0&&t(p)}}});console.log("OCR completed:",{textLength:d.data.text.length,confidence:d.data.confidence});const C=d.data.text;if(!C||C.trim().length===0)throw new Error("No text could be extracted from the image. Please try a clearer image with visible text.");const k=yt(C);return{data:{messageId:"OCR_PARSED",receivingId:`ocr-${Date.now()}`,parsedText:C,confidence:d.data.confidence/100,sections:k}}}catch(u){throw console.error("OCR Error:",u),new Error(u.message||"Failed to extract text from image. Please try a clearer image.")}}console.log("âš ï¸ TEST_MODE is FALSE - Using backend API (this will fail without backend)");const w=new FormData;return w.append("image",e),await ae.post("/ocr/parse",w,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:u=>{if(t&&u.total){const d=Math.round(u.loaded*100/u.total);t(d)}}})},async getOCRStatus(e){return X?(await new Promise(a=>setTimeout(a,300)),{data:{status:"completed",progress:100}}):await ae.get(`/ocr/status/${e}`)}};function kt(e){var k,l,p,y;const t=e.split(`
`).filter(v=>v.trim().length>0);if(t.length===0)return[];const a=t[0].trim(),s=fe(a).map(v=>v.toLowerCase().trim()),f=q(s,["name","item","item name","product"]),w=q(s,["price","cost","amount"]),g=q(s,["description","desc","details"]),u=q(s,["category","section","type","group"]);if(f===-1)throw new Error('CSV must have a "name" column');const d=new Map;for(let v=1;v<t.length;v++){const b=fe(t[v]),A=(k=b[f])==null?void 0:k.trim();if(!A||A.length===0)continue;const _=w>=0?(l=b[w])==null?void 0:l.trim():"0",O=parseFloat(_.replace(/[^0-9.]/g,""))||0,m=g>=0?(p=b[g])==null?void 0:p.trim():"",T=u>=0?(y=b[u])==null?void 0:y.trim():"Menu Items";d.has(T)||d.set(T,[]),d.get(T).push({name:A,description:m,price:O,available:!0})}return Array.from(d.entries()).map(([v,b])=>({name:v,items:b}))}function fe(e){const t=[];let a="",s=!1;for(let f=0;f<e.length;f++){const w=e[f];w==='"'?s=!s:w===","&&!s?(t.push(a),a=""):a+=w}return t.push(a),t.map(f=>f.trim().replace(/^"|"$/g,""))}function q(e,t){for(const a of t){const s=e.findIndex(f=>f.includes(a)||a.includes(f));if(s!==-1)return s}return-1}export{yt as a,Tt as o,kt as p};
