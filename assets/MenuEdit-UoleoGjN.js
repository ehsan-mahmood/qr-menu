import{_ as Z,u as ee,r,j as $,o as te,T as se,I as ae,c as n,d as t,e as y,t as m,f as ne,b as le,g,k as oe,v as k,p as P,F as V,l as U,w as ie,i as l}from"./index-Dpv-nFGf.js";import{m as D}from"./menuService-DyBKZB5h.js";import{q as re}from"./qrService-TqEF4dyz.js";import{o as ue,a as L,p as ce}from"./csvParser-BmI3wRCE.js";import"./_commonjsHelpers-Cpj98o6Y.js";const de={class:"menu-edit-page"},pe={class:"header-bar"},ve={class:"header-content"},me={class:"header-top"},fe={key:0,class:"menu-subtitle"},he={class:"content"},ye={key:0,class:"empty-state"},_e={key:1,class:"error-card"},be={class:"error-message"},ge={key:2,class:"form-container"},ke={class:"section-card"},Ce={class:"section-card"},Me={class:"tabs-container"},Se={key:0,class:"upload-section"},xe={key:0,class:"upload-icon"},Re={key:1,class:"upload-icon"},we={class:"upload-text"},Ie=["disabled"],Ve={key:0},Ue={key:1},Fe={key:1,class:"ocr-results"},Oe={class:"info-banner info-banner-success"},Pe={class:"info-banner-text"},Te={class:"form-group"},Ee={key:0,class:"parsed-preview"},Ne={class:"parsed-section-name"},Be={class:"parsed-items-list"},$e={key:1,class:"upload-section"},De={key:0,class:"upload-icon"},Le={key:1,class:"upload-icon"},qe={class:"upload-text"},Ae={key:2,class:"manual-entry-section"},je={class:"manual-entry-info"},ze={class:"section-header"},Ge=["onUpdate:modelValue"],Qe=["onClick"],Je={class:"item-inputs"},He=["onUpdate:modelValue"],Ke=["onUpdate:modelValue"],We=["onUpdate:modelValue"],Xe=["onUpdate:modelValue"],Ye=["onClick"],Ze=["onClick"],et={class:"section-card save-section"},tt=["disabled"],st={key:0},at={key:1},nt={key:0,class:"save-hint"},lt={__name:"MenuEdit",setup(ot){const T=le(),S=ee(),x=r(!0),f=r(null),M=r(!1),q=r(null),C=r(""),d=r("manual"),E=r(null),_=r(null),R=r(!1),F=r(0),w=r(""),h=r(""),v=r([]),N=r(null),I=r(null),p=r([]),A=$(()=>v.value.reduce((o,e)=>o+e.items.length,0)),O=$(()=>d.value==="manual"?p.value.length>0&&p.value.some(o=>o.items.length>0):d.value==="ocr"?v.value.length>0:d.value==="csv"?p.value.length>0:!1);te(async()=>{await B()});const B=async()=>{var o,e;x.value=!0,f.value=null;try{const s=S.merchantId||((o=S.user)==null?void 0:o.merchantId)||"merchant-001";let a=null;try{const b=(await re.getMerchantQRCodes(s)).data||[];b.length>0&&(a=b[0].menuId)}catch(c){console.log("Could not get menu ID from QR codes:",c)}if(!a&&se&&(a=ae.menuId),!a){f.value="No menu found. Please create a menu first.",x.value=!1;return}q.value=a;const i=await D.getMenuById(a),u=((e=i.data)==null?void 0:e.data)||i.data;C.value=u.menuName||"Main Menu",u.sections&&u.sections.length>0?p.value=u.sections.map(c=>({name:c.name,items:c.items.map(b=>({name:b.name,description:b.description||"",price:b.price,category:b.category||""}))})):p.value=[{name:"Menu Items",items:[]}]}catch(s){console.error("Failed to load menu:",s),f.value=s.message||"Failed to load menu. Please try again."}finally{x.value=!1}},j=o=>{const e=o.target.files[0];e&&(_.value=e,w.value="",h.value="",v.value=[])},z=async()=>{var o;if(_.value){R.value=!0,F.value=0;try{const e=await ue.parseMenuImage(_.value,a=>{F.value=a}),s=((o=e.data)==null?void 0:o.data)||e.data;w.value=s.parsedText||"",h.value=s.parsedText||"",v.value=s.sections||[],v.value.length===0&&h.value&&(v.value=L(h.value))}catch(e){console.error("OCR processing error:",e),f.value=e.message||"Failed to process image. Please try again."}finally{R.value=!1}}},G=()=>{h.value.trim()&&(v.value=L(h.value))},Q=async o=>{const e=o.target.files[0];if(e){I.value=e;try{const s=await e.text(),a=ce(s);p.value=a}catch(s){console.error("CSV parsing error:",s),f.value=s.message||"Failed to parse CSV file. Please check the format."}}},J=()=>{const o=`name,price,description,category
Espresso,3.50,Strong Italian coffee,Coffee
Cappuccino,4.50,Espresso with steamed milk,Coffee
Croissant,3.00,Buttery French pastry,Pastry`,e=new Blob([o],{type:"text/csv"}),s=URL.createObjectURL(e),a=document.createElement("a");a.href=s,a.download="menu_template.csv",a.click(),URL.revokeObjectURL(s)},H=()=>{p.value.push({name:"",items:[]})},K=o=>{p.value.splice(o,1)},W=o=>{p.value[o].items.push({name:"",description:"",price:0,category:""})},X=(o,e)=>{p.value[o].items.splice(e,1)},Y=async()=>{var o;if(O.value){M.value=!0,f.value=null;try{const e=S.merchantId||((o=S.user)==null?void 0:o.merchantId)||"merchant-001";let s=[];if(d.value==="ocr"&&v.value.length>0?s=v.value:s=p.value.map(i=>({name:i.name,items:i.items.map(u=>({name:u.name,description:u.description||"",price:parseFloat(u.price)||0,category:u.category||"",available:!0}))})),s=s.filter(i=>i.name&&i.items.length>0),s.length===0){f.value="Please add at least one menu item before saving.",M.value=!1;return}const a=await D.createOrUpdateMenu({merchantId:e,menuName:C.value||"Main Menu",orderEnabled:!0,sections:s});alert("âœ… Menu saved successfully!"),T.push("/dashboard")}catch(e){console.error("Failed to save menu:",e),f.value=e.message||"Failed to save menu. Please try again."}finally{M.value=!1}}};return(o,e)=>(l(),n("div",de,[t("div",pe,[t("div",ve,[t("div",me,[t("div",null,[e[8]||(e[8]=t("h1",{class:"page-title"},"Edit Menu",-1)),C.value?(l(),n("p",fe,m(C.value),1)):y("",!0)]),t("button",{onClick:e[0]||(e[0]=s=>ne(T).push("/dashboard")),class:"btn-link"}," â† Back to Dashboard ")])])]),t("div",he,[x.value?(l(),n("div",ye,[...e[9]||(e[9]=[t("div",{class:"empty-icon"},"â³",-1),t("p",{class:"empty-text"},"Loading menu...",-1)])])):f.value?(l(),n("div",_e,[e[10]||(e[10]=t("div",{class:"error-icon"},"âš ï¸",-1)),e[11]||(e[11]=t("h3",{class:"error-title"},"Failed to Load Menu",-1)),t("p",be,m(f.value),1),t("button",{onClick:B,class:"btn-primary"}," Try Again ")])):(l(),n("div",ge,[t("div",ke,[e[12]||(e[12]=t("label",{class:"input-label"},[oe(" Menu Name "),t("span",{class:"required"},"*")],-1)),g(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>C.value=s),type:"text",class:"input-field",placeholder:"e.g., Main Menu, Breakfast Menu"},null,512),[[k,C.value]])]),t("div",Ce,[e[19]||(e[19]=t("h3",{class:"section-title"},"ðŸ“‹ Update Menu Items",-1)),e[20]||(e[20]=t("p",{class:"section-description"},"Choose how you'd like to update your menu",-1)),t("div",Me,[t("button",{onClick:e[2]||(e[2]=s=>d.value="ocr"),class:P(["tab-button",{"tab-button-active":d.value==="ocr"}])}," ðŸ“· OCR Upload ",2),t("button",{onClick:e[3]||(e[3]=s=>d.value="csv"),class:P(["tab-button",{"tab-button-active":d.value==="csv"}])}," ðŸ“Š CSV Upload ",2),t("button",{onClick:e[4]||(e[4]=s=>d.value="manual"),class:P(["tab-button",{"tab-button-active":d.value==="manual"}])}," âœï¸ Manual Entry ",2)]),d.value==="ocr"?(l(),n("div",Se,[t("div",{class:"upload-area",onClick:e[5]||(e[5]=s=>{var a;return(a=E.value)==null?void 0:a.click()})},[t("input",{ref_key:"ocrFileInput",ref:E,type:"file",accept:"image/*",class:"hidden",onChange:j},null,544),_.value?(l(),n("div",Re,"âœ…")):(l(),n("div",xe,"ðŸ“·")),t("p",we,m(_.value?_.value.name:"Click to upload menu image"),1),e[13]||(e[13]=t("p",{class:"upload-hint"},"PNG, JPG up to 10MB",-1))]),_.value&&!w.value?(l(),n("button",{key:0,onClick:z,disabled:R.value,class:"btn-primary btn-full"},[R.value?(l(),n("span",Ve,"Processing... "+m(F.value)+"%",1)):(l(),n("span",Ue,"Parse Menu"))],8,Ie)):y("",!0),w.value?(l(),n("div",Fe,[t("div",Oe,[e[14]||(e[14]=t("p",{class:"info-banner-title"},"âœ… OCR Results",-1)),t("p",Pe," Found "+m(A.value)+" items. Review and edit below if needed. ",1)]),t("div",Te,[e[15]||(e[15]=t("label",{class:"input-label"}," Editable OCR Text ",-1)),g(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=s=>h.value=s),rows:"10",class:"input-field textarea-field",placeholder:"Edit the extracted text here..."},null,512),[[k,h.value]]),t("button",{onClick:G,class:"btn-secondary"}," Re-parse Text ")]),v.value.length>0?(l(),n("div",Ee,[e[16]||(e[16]=t("h4",{class:"parsed-preview-title"},"ðŸ“‹ Parsed Menu Structure",-1)),(l(!0),n(V,null,U(v.value,(s,a)=>(l(),n("div",{key:a,class:"parsed-section"},[t("p",Ne,m(s.name)+" ("+m(s.items.length)+" items)",1),t("ul",Be,[(l(!0),n(V,null,U(s.items,(i,u)=>(l(),n("li",{key:u}," â€¢ "+m(i.name)+" - $"+m(i.price.toFixed(2)),1))),128))])]))),128))])):y("",!0)])):y("",!0)])):y("",!0),d.value==="csv"?(l(),n("div",$e,[t("div",{class:"upload-area",onClick:e[7]||(e[7]=s=>{var a;return(a=N.value)==null?void 0:a.click()})},[t("input",{ref_key:"csvFileInput",ref:N,type:"file",accept:".csv",class:"hidden",onChange:Q},null,544),I.value?(l(),n("div",Le,"âœ…")):(l(),n("div",De,"ðŸ“Š")),t("p",qe,m(I.value?I.value.name:"Click to upload CSV file"),1),e[17]||(e[17]=t("p",{class:"upload-hint"},"CSV file with columns: name, price, description, category",-1))]),t("a",{href:"#",onClick:ie(J,["prevent"]),class:"download-link"}," ðŸ“¥ Download CSV Template ")])):y("",!0),d.value==="manual"?(l(),n("div",Ae,[t("div",je,[e[18]||(e[18]=t("p",{class:"manual-entry-text"}," Add or edit menu items manually. Items are organized by sections. ",-1)),(l(!0),n(V,null,U(p.value,(s,a)=>(l(),n("div",{key:a,class:"section-item"},[t("div",ze,[g(t("input",{"onUpdate:modelValue":i=>s.name=i,type:"text",class:"input-field section-name-input",placeholder:"Section Name (e.g., Breakfast, Lunch)"},null,8,Ge),[[k,s.name]]),t("button",{onClick:i=>K(a),class:"btn-remove"}," Ã— Remove ",8,Qe)]),(l(!0),n(V,null,U(s.items,(i,u)=>(l(),n("div",{key:u,class:"item-row"},[t("div",Je,[g(t("input",{"onUpdate:modelValue":c=>i.name=c,type:"text",placeholder:"Item name",class:"input-field item-input"},null,8,He),[[k,i.name]]),g(t("input",{"onUpdate:modelValue":c=>i.price=c,type:"number",step:"0.01",placeholder:"Price",class:"input-field item-input"},null,8,Ke),[[k,i.price,void 0,{number:!0}]]),g(t("input",{"onUpdate:modelValue":c=>i.category=c,type:"text",placeholder:"Category",class:"input-field item-input"},null,8,We),[[k,i.category]])]),g(t("textarea",{"onUpdate:modelValue":c=>i.description=c,rows:"2",placeholder:"Description (optional)",class:"input-field textarea-field"},null,8,Xe),[[k,i.description]]),t("button",{onClick:c=>X(a,u),class:"btn-remove-small"}," Remove Item ",8,Ye)]))),128)),t("button",{onClick:i=>W(a),class:"btn-secondary"}," + Add Item to "+m(s.name||"Section"),9,Ze)]))),128)),t("button",{onClick:H,class:"btn-secondary btn-full"}," + Add New Section ")])])):y("",!0)]),t("div",et,[t("button",{onClick:Y,disabled:M.value||!O.value,class:"btn-primary btn-full"},[M.value?(l(),n("span",st,"Saving menu...")):(l(),n("span",at,"ðŸ’¾ Save Menu Changes"))],8,tt),O.value?y("",!0):(l(),n("p",nt," Please add at least one menu item before saving "))])]))])]))}},pt=Z(lt,[["__scopeId","data-v-1458c238"]]);export{pt as default};
